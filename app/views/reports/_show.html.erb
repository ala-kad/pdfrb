<!-- Main Container -->
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-4 min-h-screen">
  <!-- Logo Section -->
  <div class="mb-12">
    <div class="w-40 h-40 mx-auto rounded-full overflow-hidden flex items-center justify-center shadow-lg ring">
      <%= image_tag asset_path('1.png')%>
    </div>
  </div>

  <div class="section-block">
  <!-- Title & Domain Section -->
  <div class="space-y-6 mb-12">
    <h1 class="text-2xl sm:text-3xl lg:text-4xl font-bold text-center text-[#2a4798]">
      Threat Intelligence Report
    </h1>

    <p class="text-lg sm:text-xl text-[#6d6e71] text-center font-medium">
      <strong><%= @report_data.dig(:executive_summary, :targets_scope) || "Unspecified Domain" %></strong>
    </p>
  </div>
  </div>

  <div class="section-block">
  <!-- Report Metadata -->
  <div class="rounded-lg shadow-md ring p-4 mb-8">
    <h3 class="text-xl font-bold text-[#2a4798] mb-6 text-center">Report Metadata</h3>
    
    <div class="grid grid-cols-1 gap-4">
      <div class="space-y-4">
        <div class="flex justify-between items-center py-2 border-b border-gray-200">
          <span class="font-semibold text-[#6d6e71]">Version:</span>
          <span class="text-gray-600">
            <%= @report_data.dig(:report_metadata, :report_version) || "N/A" %>
          </span>
        </div>
        <div class="flex justify-between items-center py-2 border-b border-gray-200">
          <span class="font-semibold text-[#6d6e71]">Generated By:</span>
          <span class="text-gray-600">
            <%= @report_data.dig(:report_metadata, :generated_by) || "N/A" %>
          </span>
        </div>
        <div class="flex justify-between items-center py-2 border-b border-gray-200">
          <span class="font-semibold text-[#6d6e71]">Generated At:</span>
          <span class="text-gray-600">
            <%= @report_data.dig(:report_metadata, :generated_at) || "N/A" %>
          </span>
        </div>
      </div>
    </div>
  </div>
  </div>

  <div class="section-block">
  <!-- Executive Summary -->
  <div class="rounded-lg shadow-md ring p-4 mb-8">
    <h3 class="text-xl font-bold text-[#2a4798] mb-6 text-center">
      Executive Summary
    </h3>

    <% overview = @report_data.dig(:executive_summary, :overview) %>
    <% targets = @report_data.dig(:executive_summary, :targets_scope) %>
    <% highlights = @report_data.dig(:executive_summary, :high_level_findings) %>

    <% if overview.present? %>
      <div class="mb-6">
        <p class="text-[#6d6e71] leading-relaxed">
          <strong class="font-semibold">Overview:</strong> <%= overview %>
        </p>
      </div>
    <% end %>

    <!-- Metric Boxes -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-6">
      <% if highlights.present? %>
        <% subdomains = highlights[/discovered (\d+) subdomains/, 1] %>
        <% assets = highlights[/identified (\d+) exposed assets/, 1] %>
        <% leaks = highlights[/uncovered (\d+) leaked credential sets/, 1] %>

        <% if subdomains %>
          <div class="bg-[#2a4798] bg-opacity-10 rounded-lg p-4">
            <p class="text-white text-sm font-medium mb-2">Subdomains</p>
            <p class="text-2xl font-bold text-white"><%= subdomains %></p>
          </div>
        <% end %>

        <% if assets %>
          <div class="bg-[#6d6e71] bg-opacity-10 rounded-lg p-4">
            <p class=" text-black text-sm font-medium mb-2">Exposed Assets</p>
            <p class="text-2xl font-bold text-black"><%= assets %></p>
          </div>
        <% end %>

        <% if leaks %>
          <div class="bg-red-100 rounded-lg p-4">
            <p class="text-red-600 text-sm font-medium mb-2">Leaked Credentials</p>
            <p class="text-2xl font-bold text-red-600"><%= leaks %></p>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
  </div>

  <!-- Methodology Section -->
  <div class="section-block">
    <% methodology = @report_data[:methodology] || [] %>
    <% task_categories = {
      "DNS Record Enumeration" => "Domain & DNS Intelligence",
      "WHOIS Enumeration" => "Domain & DNS Intelligence",
      "ASN Enumeration" => "Network & Infrastructure",
      "Subdomain Enumeration" => "Discovery",
      "Certificate Fetching" => "Discovery",
      "Shared Hosting Check" => "Network & Infrastructure",
      "Assets Search" => "Exposed Assets",
      "Logstealers Search" => "Leak Detection",
      "Search Leaks" => "Leak Detection",
      "Combo Search" => "Leak Detection",
      "Fetch Organization Info" => "Employee Informations",
      "Employees Search" => "Employee Informations",
      "File Scraper" => "Discovery",
      "Process Found Files" => "Analysis & Processing"
    } %>
    <% critical_tasks = ["Logstealers Search", "Search Leaks", "Process Found Files", "Assets Search"] %>
    
    <% if methodology.any? %>
      <div class="rounded-lg shadow-md ring p-4 mb-8">
        <h3 class="text-xl font-bold text-[#2a4798] mb-6 text-center">Methodology</h3>
  
        <% grouped = methodology.group_by { |task| task_categories[task[:task]] || "Other" } %>
  
        <% grouped.each do |category, tasks| %>
          <div class="mb-6">
            <h4 class="text-lg text-[#4b566b] font-semibold mb-3 pb-1 border-b-2 border-[#3c5fc3]">
              <%= category %>
            </h4>
            
            <div class="mt-4 space-y-4">
              <% tasks.each do |task| %>
                <% is_critical = critical_tasks.include?(task[:task]) %>
                <div class="p-4 rounded-lg border-l-4 <%= is_critical ? 'border-red-400 bg-red-50' : 'border-[#3c5fc3] bg-blue-50' %>">
                  <strong class="<%= is_critical ? 'text-red-600' : 'text-[#5c7598]' %> block mb-1">
                    <%= task[:task] %> <%= "(CRITICAL)" if is_critical %>
                  </strong>
                  <span class="text-sm text-gray-500 block mb-1">
                    Status: <%= task[:status] %>
                  </span>
                  <span class="text-sm text-[#5c7598]">
                    <%= task[:description] %>
                  </span>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>   

  <!-- Findings Section -->
  <div class="section-block">
    <% dns_info = @report_data.dig(:findings, :domain_dns_intelligence) || {} %>
    <% dns_summary = dns_info[:dns_records_summary] || {} %>
    <% whois = dns_info[:whois_info_shown] || [] %>
    <% if dns_info.present? %>
      <div class="my-10 rounded-lg shadow-md ring p-4 mb-8">
        <h3 class="text-xl font-bold text-[#2a4798] mb-5 text-center">Domain & DNS Intelligence</h3>
        <!-- Domain Info -->
        <div class="mb-6">
          <h4 class="text-lg font-semibold text-[#4b566b] mb-3">Domains</h4>
          <p class="text-sm text-[#5c7598]">
            <strong>Total Domains Identified:</strong> <%= dns_info[:domains] || 0 %>
          </p>
        </div>
        <!-- DNS Info -->
        <div class="mb-6">
          <h4 class="text-lg font-semibold text-[#4b566b] mb-3">DNS Records</h4>

          <!-- NS Records -->
          <% if dns_summary[:ns_records_info].present? %>
            <h5 class="text-sm text-gray-500 mb-2">NS Records</h5>
            <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200 text-center table-auto">
            <thead class="bg-[#2a4798]">
              <tr>
                <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">Name</th>
                <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">IP</th>
              </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <tr class="hover:bg-gray-50">
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-[#6d6e71]">ns1.example.com</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-[#6d6e71]">192.168.1.1</td>
                </tr>
              </tbody>
            </table>
            </div>
            <% if dns_summary[:ns_note] %>
              <p class="mt-2 text-xs text-gray-400"><%= dns_summary[:ns_note] %></p>
            <% end %>
          <% end %>

          <!-- MX Records -->
          <% if dns_summary[:mx_records_info].present? %>
            <h5 class="text-sm text-gray-500 mt-6 mb-2">MX Records</h5>
            <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200 text-center table-auto">
              <thead class="bg-[#2a4798]">
                <tr>
                  <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">Name</th>
                  <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">IP</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <tr class="hover:bg-gray-50">
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-[#4b566b]">mail.example.com</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-[#4b566b]">192.168.1.2</td>
                </tr>
              </tbody>
            </table>
            </div>
            <% if dns_summary[:mx_note] %>
              <p class="mt-2 text-xs text-gray-400"><%= dns_summary[:mx_note] %></p>
            <% end %>
          <% end %>
        </div>

        <!-- WHOIS Info -->
        <% if whois.any? %>
          <div>
            <h4 class="text-lg font-semibold text-[#4b566b] mb-3">WHOIS Records</h4>
            <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200 text-center table-auto">
              <thead class="bg-[#2a4798]">
                <tr>
                  <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">Domain</th>
                  <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">Registrar</th>
                  <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">Created</th>
                  <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">Updated</th>
                  <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">Expires</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <tr class="hover:bg-gray-50">
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-[#4b566b]">example.com</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-[#4b566b]">RegistrarX</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-[#4b566b]">2020-01-01</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-[#4b566b]">2021-01-01</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-[#4b566b]">2023-01-01</td>
                </tr>
              </tbody>
            </table>
            </div>
            <% if dns_info[:whois_note] %>
              <p class="mt-2 text-xs text-gray-400"><%= dns_info[:whois_note] %></p>
            <% end %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- Network Infrastructure Section -->
  <div class="section-block">
    <% network = @report_data.dig(:findings, :network_infrastructure) || {} %>
    <% shared_summary = network[:shared_hosting_summary] || {} %>
    <% shared_hosts = shared_summary[:hosts] || [] %>
    <% if network[:asn_count].to_i > 0 || shared_hosts.any? %>
      <div class="my-10 rounded-lg shadow-md ring p-4 mb-8">
        <h3 class="text-xl font-bold text-[#2a4798] mb-5 text-center">Network Infrastructure</h3>

        <!-- ASN Count -->
        <% if network[:asn_count].to_i > 0 %>
          <div class="mb-6">
            <h4 class="text-lg font-semibold text-[#4b566b] mb-2">AS Number Overview</h4>
            <p class="text-sm text-[#5c7598]">
              <strong>Total ASNs Identified:</strong> <%= network[:asn_count] %>
            </p>
          </div>
        <% end %>

        <!-- Shared Hosting Exposure -->
        <% if shared_hosts.any? %>
          <div class="mt-6">
            <h4 class="text-lg font-semibold text-[#121e2b] mb-3">Shared Hosting Exposure</h4>
            <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200 text-center table-auto">
              <thead class="bg-[#2a4798]">
                <tr>
                  <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">Domain</th>
                  <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">Shared With</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <tr class="hover:bg-gray-50">
                  <td class="px-3 py-2 whitespace-nowrap text-sm text-[#6d6e71]">example.com</td>
                  <td class="px-3 py-2">
                    <ul class="list-none m-0 p-0 space-y-1">
                      <li class="text-sm text-[#6d6e71]">shared1.com</li>
                      <li class="text-sm text-[#6d6e71]">shared2.com</li>
                    </ul>
                  </td>
                </tr>
              </tbody>
            </table>
            </div>

            <% if shared_summary[:note].present? %>
              <p class="mt-2 text-xs text-gray-400"><%= shared_summary[:note] %></p>
            <% end %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- HTTPS Section -->
  <div class="section-block">
    <% subdomains = @report_data.dig(:findings, :subdomain_enumeration) || {} %>
    <% shown = subdomains[:shown] || [] %>
    <% if subdomains[:total_found].to_i > 0 %>
      <div class="my-10 p-4 ring rounded-lg shadow-md">
        <h3 class="text-xl font-bold text-[#2a4798] mb-5 text-center">Subdomain Enumeration</h3>

        <!-- Description -->
        <p class="text-sm text-[#4b566b] mb-6 leading-relaxed">
          This section highlights a sample of the subdomains identified during the reconnaissance process. The full list — along with associated technologies, open ports, and vulnerabilities — is available in the Oktoboot dashboard for deeper investigation and remediation.
        </p>

        <!-- Total Count -->
        <p class="text-sm text-[#4b566b] mb-6">
          <strong>Total Unique Subdomains Found:</strong> <%= subdomains[:total_found] %>
        </p>

        <!-- Grouped Table -->
        <% grouped = shown.group_by { |s| s.split('.').last(2).join('.') } %>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-[#2a4798]">
              <tr>
                <th class="px-3 py-3 text-center text-xs font-medium text-white tracking-wider">Root Domain</th>
                <th class="px-3 py-3 text-center text-xs font-medium text-white tracking-wider">Subdomain</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <% grouped.each do |root, subs| %>
                <% subs.each_with_index do |sd, index| %>
                  <% subdomain_style = case sd
                    when /admin|login|secure/i then 'text-red-500 font-semibold'
                    when /dev|test|staging/i then 'text-blue-400 font-semibold'
                    when /internal|private|backup/i then 'text-amber-500 font-semibold'
                    else 'text-[#4b566b]'
                  end %>
                  <tr class="hover:bg-gray-50">
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-[#6d6e71] font-semibold">
                      <%= index.zero? ? root : "" %>
                    </td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-[#6d6e71] font-semibold">
                      <%= sd %>
                    </td>
                  </tr>
                <% end %>
              <% end %>
            </tbody>
          </table>
        </div>

        <% if subdomains[:note].present? %>
          <p class="mt-4 text-xs text-gray-400"><%= subdomains[:note] %></p>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- Certificate Enumeration Section -->
  <div class="section-block">            
    <% certs = @report_data.dig(:findings, :certificate_https, :certificates) || [] %>
    <% if certs.any? %>
      <% now = Time.now.utc %>
      <div class="my-10 rounded-lg shadow-md ring p-4 mb-8">
        <h3 class="text-xl font-bold text-[#2a4798] mb-5 text-center">Certificate HTTPS Enumeration</h3>
        <p class="text-sm text-[#4b566b] mb-6 leading-relaxed">
          This section summarizes digital certificates discovered during reconnaissance. Certificates may reveal subdomains or exposure timelines. Review carefully — and check Oktoboot Dashboard for full details.
        </p>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200 table-auto">
            <thead class="bg-[#2a4798]">
              <tr>
                <th class="px-3 py-3 text-center text-xs font-medium text-white capitalize tracking-wider">Common Name</th>
                <th class="px-3 py-3 text-center text-xs font-medium text-white capitalize tracking-wider">Valid From</th>
                <th class="px-3 py-3 text-center text-xs font-medium text-white capitalize tracking-wider">Valid To</th>
              </tr>
            </thead>
            <tbody>
                <tr class="hover:bg-gray-50">
                  <td class="px-3 py-4 whitespace-nowrap text-sm text-[#4b566b] text-center">
                    example.com
                  </td>
                  <td class="px-3 py-4 whitespace-nowrap text-sm text-[#4b566b] text-center">
                    2024-01-01
                  </td>
                  <td class="px-3 py-4 whitespace-nowrap text-sm text-red-500 font-semibold text-center">
                    2025-01-01
                      <span class="text-red-500 font-semibold ml-1">(expired)</span>
                  </td>
                </tr>
            </tbody>
          </table>
        </div>
        <% if certs.size == 5 %>
          <p class="mt-4 text-xs text-gray-400">
            Only the first 5 certificates are shown. View the Oktoboot dashboard for the full list.
          </p>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- Exposed Assets Section -->
  <div class="section-block">
    <% assets = @report_data.dig(:findings, :exposed_assets, :shown) || [] %>
    <% if assets.any? %>
      <div class="my-10 rounded-lg shadow-md ring p-4 mb-8">
        <h3 class="text-xl font-bold text-[#2a4798] mb-4 text-center">Exposed Assets Overview</h3>
        <p class="text-sm text-[#4b566b] mb-6 leading-relaxed">
          These exposed assets may pose risk due to open ports, outdated services, or certificate leaks. Risk levels and recommendations are based on observed configurations and known vulnerabilities.
        </p>
        <% assets.each do |asset| %>
          <!-- Asset Title -->
          <div class="mb-8 pb-6 border-b border-gray-200 last:border-0">
            <h4 class="text-lg font-bold text-[#9ecfff] mb-3"><%= asset[:ip] %></h4>

            <!-- Metadata -->
            <div class="text-sm text-[#4b566b] mb-4 flex flex-wrap gap-x-4">
              <span><strong>Domain:</strong> <%= asset[:domain].presence || "N/A" %></span>
              <span><strong>ISP:</strong> <%= asset[:isp].presence || "N/A" %></span>
              <span>
                <strong>Risk:</strong>
                <span class="<%= case asset[:risk_level]
                  when "High" then 'text-red-500 font-semibold'
                  when "Medium" then 'text-amber-500 font-semibold'
                  when "Low" then 'text-blue-400 font-semibold'
                  else 'text-[#4b566b]'
                end %>">
                  <%= asset[:risk_level] %>
                </span>
              </span>
            </div>

            <!-- Open Ports -->
            <% if asset[:open_ports].present? %>
              <div class="mt-6">
                <h5 class="text-base font-semibold text-[#4b566b] mb-3">Open Ports</h5>
                <div class="overflow-x-auto">
                  <table class="min-w-full divide-y divide-gray-200 text-center table-auto">
                    <thead class="bg-[#2a4798]">
                      <tr>
                        <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">Port</th>
                        <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">Module</th>
                        <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">Version</th>
                        <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">SSL</th>
                      </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                      <tr class="hover:bg-gray-50">
                        <td class="px-3 py-2 text-sm text-[#4b566b]">443</td>
                        <td class="px-3 py-2 text-sm text-[#4b566b]">nginx</td>
                        <td class="px-3 py-2 text-sm text-[#4b566b]">1.18</td>
                        <td class="px-3 py-2 text-sm text-[#4b566b]">
                          <div class="space-y-2">
                            <div>
                              <p class="text-sm font-semibold text-[#4b566b]">dev.example.com</p>
                              <p class="text-xs text-gray-400">Let's Encrypt | TLS 1.2</p>
                            </div>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            <% end %>

            <!-- Vulnerabilities -->
            <% if asset[:vulnerabilities].present? %>
              <div class="mt-8">
                <h5 class="text-base font-semibold text-[#4b566b] mb-4">Top Vulnerabilities</h5>
                <div class="space-y-4">
                  <% asset[:vulnerabilities].first(5).each do |vuln| %>
                    <div class="p-4 bg-gray-50 rounded-lg">
                      <h6 class="text-sm font-bold text-[#73c2fb] mb-2"><%= vuln[:title] %></h6>
                      <p class="text-sm <%= case vuln[:severity]
                        when 'Critical' then 'text-red-700'
                        when 'High' then 'text-red-500'
                        when 'Medium' then 'text-amber-500'
                        else 'text-gray-400'
                      end %> mb-2">
                        <%= vuln[:severity] %> severity — CVSS: <%= vuln[:cvss] %>
                      </p>
                      <p class="text-sm text-[#4b566b] leading-relaxed">
                        <%= vuln[:description] %>
                      </p>
                    </div>
                  <% end %>
                </div>

                <% if asset[:vulnerabilities].size > 5 %>
                  <p class="mt-3 text-xs text-gray-400 italic">
                    Only the first 5 vulnerabilities are shown. See dashboard for more.
                  </p>
                <% end %>
              </div>
            <% end %>

            <!-- Recommendation -->
            <% if asset[:recommendation].present? %>
              <div class="mt-6 p-4 bg-blue-50 rounded-lg border-l-4 border-[#73c2fb]">
                <h6 class="text-sm font-semibold text-[#4b566b] mb-2">Recommended Mitigation</h6>
                <p class="text-sm text-[#4b566b] leading-relaxed">
                  <%= asset[:recommendation] %>
                </p>
              </div>
            <% end %>
          </div>
        <% end %>
        <% if @report_data.dig(:findings, :exposed_assets, :note).present? %>
          <p class="mt-4 text-xs text-gray-400">
            <%= @report_data.dig(:findings, :exposed_assets, :note) %>
          </p>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- Data Leaks & Credential Exposure Section -->
  <div class="section-block">
    <% leaks = @report_data.dig(:findings, :data_leaks_and_breaches) || {} %>
    <% if leaks[:logstealer_leaks][:total].to_i > 0 || leaks[:public_leaks][:total].to_i > 0 || leaks[:combo_leaks][:total].to_i > 0 %>
      <div class="my-10 rounded-lg shadow-md ring p-4 mb-8">
        <h3 class="text-xl font-bold text-[#2a4798] mb-5 text-center">Data Leaks & Credential Exposure</h3>

        <p class="text-sm text-[#4b566b] mb-6 leading-relaxed">
          These exposed credentials were found across malware logs, public breaches, and combo lists. They may be linked to user accounts or internal access points. Please investigate and rotate impacted credentials immediately. Full dump available in the Oktoboot dashboard.
        </p>

        <!-- Logstealer Leaks -->
        <% if leaks[:logstealer_leaks][:shown].present? %>
          <div class="mt-6">
            <h4 class="text-lg font-semibold text-[#4b566b] mb-4">Logstealer Leaks</h4>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200 table-auto text-center">
                <thead class="bg-[#2a4798]">
                  <tr>
                    <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">URL</th>
                    <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">Email</th>
                    <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">Password</th>
                    <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">Year</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 text-sm text-[#4b566b]">
                      http://malicious.site
                    </td>
                    <td class="px-6 py-4 text-sm text-[#4b566b]">john@example.com</td>
                    <td class="px-6 py-4 text-sm text-[#4b566b]">123456</td>
                    <td class="px-6 py-4 text-sm text-[#4b566b]">2022</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <% if leaks[:logstealer_leaks][:note].present? %>
              <p class="mt-3 text-xs text-gray-400 italic">
                <%= leaks[:logstealer_leaks][:note] %>
              </p>
            <% end %>
          </div>
        <% end %>

        <!-- Public Breach Leaks -->
          <div style="print-break">
          <% if leaks[:public_leaks][:shown].present? %>
            <h4 class="text-xl font-bold text-[#2a4798] mb-5 text-center">Public Breach Leaks</h4>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200 table-auto text-center">
                <thead class="bg-[#2a4798]">
                  <tr>
                    <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">Leak Source</th>
                    <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">Email</th>
                    <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">Password</th>
                    <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">Year</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-[#4b566b]">SomeSource</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-[#4b566b]">jane@example.com</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-[#4b566b]">password</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-[#4b566b]">2021</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <% if leaks[:public_leaks][:note].present? %>
              <p style="font-size: 13px; color: #aaaaaa; margin-top: 8px;"><%= leaks[:public_leaks][:note] %></p>
            <% end %>
          <% end %>
        </div>

        <!-- Combo List Leaks -->
        <div style="print-break">
          <% if leaks[:combo_leaks][:shown].present? %>
          <h4 class="text-xl font-bold text-[#2a4798] mb-5 text-center"> Combo List Leaks</h4>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200 table-auto text-center">
              <thead class="bg-[#2a4798]">
                <tr>
                  <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">Domain</th>
                  <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">Email</th>
                  <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">Password</th>
                  <th class="px-6 py-3 text-xs font-medium text-white capitalize tracking-wider">Year</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <tr class="hover:bg-gray-50">
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-[#4b566b]">admin123</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-[#4b566b]">example.com</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-[#4b566b]">admin@example.com</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-[#4b566b]">2020</td>
                </tr>
              </tbody>
            </table>
          </div>
          <% if leaks[:combo_leaks][:note].present? %>
            <p style="font-size: 13px; color: #aaaaaa; margin-top: 8px;"><%= leaks[:combo_leaks][:note] %></p>
          <% end %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

  <!-- Employee Enumeration Section  -->
  <div class="section-block">                  
    <% employees = @report_data.dig(:findings, :employee_information) || {} %>
    <% shown = employees[:shown] || [] %>
    <% if employees[:total_found].to_i > 0 %>
      <div class="my-10 p-4 ring rounded-lg shadow-md">
        <h3 class="text-xl font-bold text-[#2a4798] mb-4 text-center">Employee Enumeration</h3>

        <p class="text-sm text-[#4b566b] mb-3 leading-relaxed">
          This section lists publicly accessible employees discovered during reconnaissance. Full role breakdowns and exposure context are available in the Oktoboot dashboard.
        </p>

        <p class="text-sm text-[#4b566b] mb-5">
          <strong>Total Identified:</strong> <%= employees[:total_found] %>
        </p>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <% shown.each do |emp| %>
            <div class="bg-[#1a273b] p-3 rounded-lg">
              <p class="text-sm font-semibold text-white mb-1"><%= emp[:fullname] %></p>
              <p class="text-xs text-gray-300"><%= emp[:poste].presence || "N/A" %></p>
            </div>
          <% end %>
        </div>

        <% if employees[:note].present? %>
          <p class="mt-5 text-xs text-gray-400 italic">
            <%= employees[:note] %>
          </p>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- Metadata & Public Files Section -->
  <div class="section-block">
    <% meta = @report_data.dig(:findings, :metadata_public_files) || {} %>
    <% files = meta[:files] || [] %>
    <% sensitive = meta[:sensitive_data] || [] %>

    <% if files.any? || sensitive.any? %>
      <div class="my-10 p-4 ring rounded-lg shadow-md">
        <h3 class="text-xl font-bold text-[#2a4798] mb-4 text-center">Metadata & Public Files</h3>

        <p class="text-sm text-[#4b566b] mb-6 leading-relaxed">
          This section lists publicly accessible files and detected metadata exposures. View complete data in your Oktoboot dashboard.
        </p>

        <% if files.any? %>
          <h4 class="text-lg font-semibold text-[#4b566b] mb-4">Discovered Files</h4>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200 text-center table-auto">
              <thead class="bg-[#2a4798]">
                <tr>
                  <th class="px-6 py-3 text-xs font-medium text-white capitalizetracking-wider">File Name</th>
                  <th class="px-6 py-3 text-xs font-medium text-white capitalizetracking-wider">URL</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <tr class="hover:bg-gray-50">
                  <td class="px-6 py-2 text-sm text-[#4b566b]">
                    report.pdf
                  </td>
                  <td class="px-6 py-4">
                    <a href="http://example.com/report.pdf" target="_blank" class="text-[#4fb7ff] text-sm hover:underline">
                      http://example.com/report.pdf
                    </a>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- Risk Assessment Section -->
  <div class="section-block" >
    <% risks = @report_data[:risk_assessment] || {} %>
    <% high_risks = risks[:high_risks] || [] %>
    <% medium_risks = risks[:medium_risks] || [] %>
    <% info_risks = risks[:info_risks] || [] %>

    <% if high_risks.any? || medium_risks.any? || info_risks.any? %>
      <div class="my-10 p-4 ring rounded-lg shadow-md">
        <h3 class="text-xl font-bold text-[#2a4798] mb-4 text-center">Risk Assessment</h3>

        <p class="text-sm text-[#4b566b] mb-5 leading-relaxed">
          The following risks were identified during the reconnaissance phase. They are categorized by severity and may require immediate remediation or strategic consideration.
        </p>

        <% if high_risks.any? %>
          <h4 class="text-lg font-semibold text-[#ff6b6b] mt-5 mb-3">High Risks</h4>
          <% high_risks.each do |risk| %>
            <div class="pl-3 mt-1.5 text-[#5c7598]">
              <span class="font-medium mr-2">‣</span><%= risk %>
            </div>
          <% end %>
        <% end %>

        <% if medium_risks.any? %>
          <h4 class="text-lg font-semibold text-[#f7c948] mt-8 mb-3">Medium Risks</h4>
          <% medium_risks.each do |risk| %>
            <div class="pl-3 mt-1.5 text-[#5c7598]">
              <span class="font-medium mr-2">‣</span><%= risk %>
            </div>
          <% end %>
        <% end %>

        <% if info_risks.any? %>
          <h4 class="text-lg font-semibold text-[#9ecfff] mt-8 mb-3">Informational</h4>
          <% info_risks.each do |risk| %>
            <div class="pl-3 mt-1.5 text-[#5c7598]">
              <span class="font-medium mr-2">‣</span><%= risk %>
            </div>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- Recommendations Section -->
  <div class="section-block">
    <% recommendations = @report_data[:recommendations] || {} %>
    <% if recommendations.values.flatten.any? %>
      <div class="my-10 p-4 ring rounded-lg shadow-md">
        <h3 class="text-xl font-bold text-[#2a4798] mb-5 text-center">
          Recommendations
        </h3>

        <p class="text-sm text-[#4b566b] mb-4 leading-relaxed">
          Prioritized guidance based on reconnaissance findings. Grouped by severity for operational clarity.
        </p>

        <% {
          "Critical" => [recommendations[:critical], "#ff4c4c"],
          "Important" => [recommendations[:important], "#f7c948"],
          "Best Practice" => [recommendations[:best_practice], "#4fb7ff"]
        }.each do |severity, (items, color)| %>
          <% if items.any? %>
            <h4 class="text-lg font-semibold mt-8 mb-4" style="color: <%= color %>">
              <%= severity %> Recommendations
            </h4>

            <div class="space-y-4">
              <% items.each do |rec| %>
                <div class="p-4 rounded-lg border-l-4" style="border-color: <%= color %>; background-color: <%= color %>0a">
                  <p class="text-sm font-medium mb-2" style="color: <%= color %>">
                    <strong>Area:</strong> <%= rec[:area] %>
                  </p>
                  <p class="text-sm text-[#5c7598] leading-relaxed">
                    <%= rec[:recommendation] %>
                  </p>
                </div>
              <% end %>
            </div>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>

